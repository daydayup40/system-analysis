# DisplayMirror的设计与实现
内容：

- 项目简介&功能需求
- 设计实现总结
- 目前工作状况
- 相关总结

## 项目简介&功能需求
完善oto的display功能，包括:  

|描述|计划|完成|描述
|---|---|---|---|
|双屏mirror|Y|Y|
|分辨率调整|8/1-8/31|N|
|多屏extend|N||
|net显示|N||
|wifi显示|N||
|投影几种方式|N||复制、扩展、仅第二屏，仅本屏
|投影快捷键|N||Fn+f2 或其他，根据每台电脑不同而不同

### 当前开发人员 (20160801-20160831)
王建兴 - oto支持双屏mirror模式的显示

## 设计实现总结　　

1.开机之后再插入显示屏不能双屏显示　　
问题原因:drm_gralloc部分进行了屏幕插入事件的监听，但是功能没有正常完成；  
chengang@emindsoft.com.cn重写了监听事件的功能，可以正常显示  

2.T45机器双屏mirror不正常
问题原因:可以正常监听显示屏hotplug事件,但是在将primary screen数据复制到hdmi screen时出现问题；  
这部分是和具体的gpu型号相关的，T45上的cpu和gpu型号比较新，相关配套的driver和库的实现还有许多bug;  
技德吴圳提供了相关的patch修复了该bug.  

3.primary和hdmi显示器分辨率不一致时导致较小分辨率的显示器不能完全显示一帧的画面
问题原因:根据分辨率来分配每一帧的内存，结果两个内存不一致，在复制内存图像数据时只能复制一部分  
在选择显示模式时选择尽可能大的分辨率；  
这个需要进一步完善工作，可以进行不同分辨率的调节  

### 目前工作
实现和ubuntu,windows的调节分辨率功能  
目前可以在开机时设置预留的分辨率,但是仍然不可以实现动态调节分辨率功能;

- 第一阶段(3/8-12/8):  
实现了调整primary屏的大小,和系统原生相比主要集中在更改framebuffer大小；(bug:只能更改一次，否则drm_grlloc部分会报错，需要继续解决)

- 剩余工作:  
解决第一阶段的bug；  
增加第二个屏分辨率调整的工作  
协调primary和secondary屏的分辨率部分  

- 预测:
中间可能会遇到平布不会显示满的情况，可能是和屏有关的；后续可能会需要调整内核DRM部分；

### 技术总结
